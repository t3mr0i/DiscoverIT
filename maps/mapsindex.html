<!DOCTYPE html>
<html>

<head>

    <title>DiscoverIT</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <!-- include the core styles -->
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="./coordinates.js"></script>

    <style>
        /* Always set the map height explicitly to define the size of the div
       * element that contains the map.(53.106733, 8.84503) */
        
        .swal-overlay {
            background-color: rgba(43, 165, 137, 0.45);
        }
        
        #map {
            height: 100%;
        }
        /* Optional: Makes the sample page fill the window. */
        
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>

<body>


    <div class="testLayer w3-center">
        <p id="spotcounter" class=" w3-center"> </p>


        <div class="w3-progress-container test" style="border-color:red;">
            <div id="myBar" class="w3-progressbar tester" style="width:0%">
                <div id="demo" class="balkenFarbe"> </div>
            </div>
        </div>

    </div>

    <div id="map"></div>


    <script>
        var prog = 0;
        var overlay;
        var gooMarker = [];
        var counter = 0;
        var universumMarker;
        const imageURL = "universum.jpg";
        const imageURLMaritim = "reef.jpg";
        const imageURLHaus = "haus.jpg";




        var im = 'http://www.robotwoods.com/dev/misc/bluecircle.png';
        //Spots






        var citymap = {};






        // Note: This example requires that you consent to location sharing when
        // prompted by your browser. If you see the error "The Geolocation service
        // failed.", it means you probably did not give permission for the browser to
        // locate you.

        function initMap() {


            citymap['universum'] = {

                center: new google.maps.LatLng(53.106733, 8.84503),
                population: 2842518
            }
            document.getElementById('spotcounter').innerHTML = "You found " + counter + " out of 3";

            var map = new google.maps.Map(document.getElementById('map'), {
                center: universum,
                zoom: 17,
                // disableDefaultUI: true,
                styles: [{
                        "featureType": "all",
                        "elementType": "all",
                        "stylers": [{
                                "saturation": "32"
                            },
                            {
                                "lightness": "-3"
                            },
                            {
                                "visibility": "on"
                            },
                            {
                                "weight": "1.18"
                            }
                        ]
                    },
                    {
                        "featureType": "administrative",
                        "elementType": "labels",
                        "stylers": [{
                            "visibility": "off"
                        }]
                    },
                    {
                        "featureType": "landscape",
                        "elementType": "labels",
                        "stylers": [{
                            "visibility": "off"
                        }]
                    },
                    {
                        "featureType": "landscape.man_made",
                        "elementType": "all",
                        "stylers": [{
                                "saturation": "-70"
                            },
                            {
                                "lightness": "14"
                            }
                        ]
                    },
                    {
                        "featureType": "poi",
                        "elementType": "labels",
                        "stylers": [{
                            "visibility": "off"
                        }]
                    },
                    {
                        "featureType": "road",
                        "elementType": "labels",
                        "stylers": [{
                            "visibility": "off"
                        }]
                    },
                    {
                        "featureType": "transit",
                        "elementType": "labels",
                        "stylers": [{
                            "visibility": "off"
                        }]
                    },
                    {
                        "featureType": "water",
                        "elementType": "all",
                        "stylers": [{
                                "saturation": "100"
                            },
                            {
                                "lightness": "-14"
                            }
                        ]
                    },
                    {
                        "featureType": "water",
                        "elementType": "labels",
                        "stylers": [{
                                "visibility": "off"
                            },
                            {
                                "lightness": "12"
                            }
                        ]
                    }
                ]

            });


            //ausgegraut 端ber bremen
            var bremenOverlay = new google.maps.Polygon({
                paths: [outerCoords],
                strokeColor: 'grey',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: 'grey',
                fillOpacity: 0.7
            });
            bremenOverlay.setMap(map);


            map.setOptions({
                draggable: false
            });






            //document.getElementById('hidemark').document.ready = hideMarkers;

            var infoWindow = new google.maps.InfoWindow({
                map: map
            });
            // MARITIM
            checked = true;

            function success(pos) {




                document.getElementById('spotcounter').innerHTML = "You found " + counter + " out of 3";

                var crd = pos.coords;
                if (crd.latitude > 53.108041 && crd.latitude < 53.108157 && crd.longitude > 8.845440 && crd.longitude < 8.846041) {
                    map.setCenter(universum);
                    if (crd.latitude > 53.106300 && crd.latitude < 53.106777 && crd.longitude > 8.84300 && crd.longitude < 8.84600 && checked == true) {

                        var myLatlng = new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude);
                        var icon = "navIcon.png"
                        var myLatmarker = new google.maps.Marker({
                            position: myLatlng,
                            map: map,
                            icon: icon,
                            zIndex: 1
                        });
                        counter++;
                        alert("test")
                        map.data.add({
                            geometry: new google.maps.Data.Polygon([outerCoords,
                                universumCords
                            ])
                        })
                        // universumOverlay.setMap(map);

                        //google.maps.event.addDomListener(window, 'load', initialize);
                        universumMarker.setVisible(false)
                        circleUniversum.setVisible(false)
                        alert("test")
                        move();
                        document.getElementById('spotcounter').innerHTML = "You found " + counter + " out of 3";


                        swal({

                                title: "CONGRATS!",
                                text: `You find the universum, you have now found ${counter} out of 3 spots`,
                                icon: "success",
                                buttons: true,
                            })
                            .then((willDelete) => {
                                if (willDelete) {
                                    swal("The museum is designed like a whale. The windows should represent its teeths.", {
                                        icon: imageURL,
                                    });
                                } else {
                                    swal('We granted you 60 points! You found " + ${counter} + "/3 spots in this area already');
                                }
                            });

                    }
                    if (crd.latitude > 53.106800 && crd.latitude < 53.106270 && crd.longitude > 8.841207 && crd.longitude < 8.841437 && checked == true) {
                        checked = false;
                        console.log("ich war in Haus")
                        swal({
                                title: "CONGRATS!",
                                text: "You found the Haus am Walde!",
                                icon: "success",
                                buttons: true,
                            })
                            .then((willDelete) => {
                                if (willDelete) {


                                    swal("Norddeutsche und internationale K端che, Fr端hst端ck und selbstgebackener Kuchen im Backsteinhaus mit Biergarten.", {
                                        icon: haus,
                                    });
                                } else {
                                    swal("We granted you 40 points! You found " + counter + " /3 spots in this area already");
                                }
                            });
                        //navigator.geolocation.clearWatch(id);
                    }




                    if (crd.latitude > 53.107600 && crd.latitude < 53.108120 && crd.longitude > 8.845700 && crd.longitude < 8.846000 && checked == true) {

                        map.data.add({
                            geometry: new google.maps.Data.Polygon([outerCoords,

                                maritimCords
                            ])
                        })
                        checked = false;

                        counter++;
                        console.log("ich war in Leibniz")

                        swal({
                                title: "CONGRATS!",
                                text: "You found the Leibniz Centre for Marine Tropical Research!",
                                icon: "success",
                                buttons: true,
                            })
                            .then((willDelete) => {
                                if (willDelete) {


                                    swal("The biggest german science center for ecology of tropic seas and coasts.", {
                                        icon: imageURLMaritim,
                                    });
                                } else {
                                    swal("We granted you 80 points! You found " + counter + " /3 spots in this area already");
                                }
                            });
                        navigator.geolocation.clearWatch(id);
                    }
                }

                // center
                if (crd.latitude > 53.104671 && crd.latitude < 53.109264 && crd.longitude > 8.838371 && crd.longitude < 8.847941) {
                    map.setCenter(cUni);
                }
                // left
                if (crd.latitude > 53.109264 && crd.latitude < 53.113857 && crd.longitude > 8.838371 && crd.longitude < 8.847941) {
                    map.setCenter(lUni);
                }
                // right
                if (crd.latitude > 53.100075 && crd.latitude < 53.104671 && crd.longitude > 8.838371 && crd.longitude < 8.847941) {
                    map.setCenter(rUni);
                }
                // top
                if (crd.latitude > 53.104671 && crd.latitude < 53.109264 && crd.longitude > 8.828801 && crd.longitude < 8.838371) {
                    map.setCenter(tUni);
                }
                // bottom
                if (crd.latitude > 53.104671 && crd.latitude < 53.109264 && crd.longitude > 8.847941 && crd.longitude < 8.857511) {
                    map.setCenter(bUni);
                }

                /* WHAT IS THIS???
                // this is center = universum
                if (crd.latitude > 53.105341 && crd.latitude < 53.105895 && crd.longitude > 8.849484 && crd.longitude < 8.850064) {
                    navigator.geolocation.clearWatch(id);
                }
                */

            }

            function error(err) {
                console.warn("error");
            }

            options = {
                enableHighAccuracy: false,
                timeout: 5000,
                maximumAge: 0
            };

            id = navigator.geolocation.watchPosition(success, error, options);


            var maritimMarker = new google.maps.Marker({
                position: maritim,

                map: map
            });
            var circleMaritim = new google.maps.Circle({
                map: map,
                radius: 100, // 10 miles in metres
                fillColor: '#AA0000',
                strokeColor: '#FF0000',
                strokeOpacity: 0.001,
                strokeWeight: 2,
                fillColor: 'green',
                fillOpacity: 0.1,
            });
            circleMaritim.bindTo('center', maritimMarker, 'position');

            // HAUS


            hausMarker = new google.maps.Marker({
                position: haus,

                map: map
            });
            var HausCircle = new google.maps.Circle({
                map: map,
                radius: 100, // 10 miles in metres
                fillColor: '#AA0000',
                strokeColor: '#FF0000',
                strokeOpacity: 0.001,
                strokeWeight: 2,
                fillColor: 'green',
                fillOpacity: 0.1,
            });
            HausCircle.bindTo('center', hausMarker, 'position');
            // universum

            universumMarker = new google.maps.Marker({
                position: universum,
                map: map
            });





            var circleUniversum = new google.maps.Circle({
                map: map,
                radius: 100, // 10 miles in metres
                fillColor: '#AA0000',
                strokeColor: '#FF0000',
                strokeOpacity: 0.001,
                strokeWeight: 2,
                fillColor: 'green',
                fillOpacity: 0.1,
            });
            circleUniversum.bindTo('center', universumMarker, 'position');

            circleUniversum.setVisible(false)
            universumMarker.setVisible(false)
            HausCircle.setVisible(false)
            hausMarker.setVisible(false)
            circleMaritim.setVisible(false)
            maritimMarker.setVisible(false)

            //navigator.geolocation.watchPosition(success, error); VLLT WICHTIG

            // var posi = navigator.geolocation.watchPosition(success);




        }


        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
        }



        move = function() {
            if (prog < 67) {
                var elem = document.getElementById("myBar");
                var width = 0;
                var id = setInterval(frame, 10);
                prog = prog + 33;
                elem.style.width = prog + '%';
                document.getElementById("demo").innerHTML = prog;

                function frame() {



                }
            }

        }



        function fail() {
            alert('navigator.geolocation failed, may not be supported');
        }

        // Construct the circle for each value in citymap. We scale population by 20.
        /*var populationOptions = {
                            paths: [outerCoords, cityCircle],

                            strokeColor: 'blue',
                            strokeOpacity: 0.1,
                            strokeWeight: 2,
                            fillColor: 'blue',
                            fillOpacity: 0.1,
                            map: map,
                            center: universum.center,
                            radius: 100
                        };
                        cityCircle = new google.maps.Circle(populationOptions);



                        var universumOverlay = new google.maps.Polygon({
                            paths: [outerCoords, universumCords],
                            strokeColor: 'red',
                            strokeOpacity: 0.1,
                            strokeWeight: 2,
                            fillColor: 'red',
                            fillOpacity: 0.1
                        });

                        var cutOut = new google.maps.Polygon({
                            paths: [outerCoords, cityCircle],
                            strokeColor: 'blue',
                            strokeOpacity: 0.8,
                            strokeWeight: 2,
                            fillColor: 'blue',
                            fillOpacity: 0.35,
                            // center: universumCPoly.center,
                            radius: 100

                        });
                        populationOptions.setMap(map);


                        cutOut.setMap(map);
*/
        /* Set the width of the side navigation to 250px */
        function openNav() {
            document.getElementById("mySidenav").style.width = "250px";
        }

        /* Set the width of the side navigation to 0 */
        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
        }
    </script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB0P18EzZD--ertW6TztEi6cwlhfy_j6Ok&callback=initMap">
    </script>

    <script src="alertify.js"></script>

</body>

</html>